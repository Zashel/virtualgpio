from ..basehandler import *

class VirtualGPIOBaseHandler(BaseHandler):
    def __init__(self):
        '''
        You must subclass it to handle the GPIO and other Stuff
        '''
        super().__init__()
        self._virtualGPIO = None

    #~~~~~~~~~PROPERTIES~~~~~~~~~#
    @property
    def virtualGPIO(self):
        return self._virtualGPIO
    
    @property
    def is_connected(self):
        return isinstance(self._virtualGPIO, VirtualGPIO)

    #~~~~~~~~~FUNCTIONS~~~~~~~~~~#
    def connect_virtual_GPIO(self, gpio):
        if isinstance(gpio, VirtualGPIO):
            self._virtualGPIO = gpio
        else:
            raise VirtualGPIOError

    #Handling functions:
    #All signals must begin with "signal_"
    def signal_connect(self, uuid, timeout):
        timeout = datetime.datetime.strptime(timeout, "%Y%m%d%H%M%S")
        self.virtualGPIO.connections[uuid] = timeout #TODO: debug this. This is going to f*ck up all.

    def signal_disconnect(self, uuid):
        self.virtualGPIO.disconnect_client(uuid)
